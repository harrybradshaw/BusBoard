@model BusBoard.Api.Location

@{
    ViewData["Title"] = "Arrivals";
}

<!DOCTYPE html>

<div>
    <h2>Closest Stops By Postcode</h2>
    <form method="GET" action="arrivals">
        <input type="text" name="postcode" id="postcode"/>
        <input type="submit" value="Find Stops & Arrivals">
    </form>
</div>

<div>
    @if (Model.Postcode is not null)
    {
        <p>Postcode: @Model.Postcode</p>

        @if (Model.Stops.Count > 0)
        {
            @foreach (var stop in Model.Stops)
            {
                <h3>@stop.Name - @stop.Indicator (@(stop.Distance+"m") away)</h3>
                <ol>
                    @for (int i = 0; i < Math.Min(5,stop.ArrivalsList.Count);i++)
                    {
                        <li><b>@stop.ArrivalsList[i].Route</b> to @stop.ArrivalsList[i].DestinationName at 
                            @stop.ArrivalsList[i].ExpectedArrival.ToShortTimeString() (@((int)((stop.ArrivalsList[i].ExpectedArrival - DateTime.Now).TotalMinutes)) min)</li>
                    }
                </ol>
            }
        } else if (!Model.IsValid())
        {
            <p> The postcode is not valid. </p>
        }                        
        
    }
    
</div>